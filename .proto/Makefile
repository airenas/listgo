GO_OPTS='Mtensorflow/compiler/tf2xla/tf2xla.proto=tensorflow/compiler/tf2xla,Mtensorflow/compiler/tf2xla/host_compute_metadata.proto=tensorflow/compiler/tf2xla,Mtensorflow/compiler/xla/service/hlo.proto=tensorflow/compiler/xla/service,Mtensorflow/compiler/xla/service/hlo_profile_printer_data.proto=tensorflow/compiler/xla/service,Mtensorflow/compiler/xla/service/session.proto=tensorflow/compiler/xla/service,Mtensorflow/compiler/xla/xla_data.proto=tensorflow/compiler/xla,Mtensorflow/compiler/xla/xla.proto=tensorflow/compiler/xla,Mtensorflow/python/framework/cpp_shape_inference.proto=tensorflow/python/framework,Mtensorflow/python/util/protobuf/compare_test.proto=tensorflow/python/util/protobuf,Mtensorflow/python/training/checkpoint_state.proto=tensorflow/python/training,Mtensorflow/contrib/mpi/mpi_msg.proto=tensorflow/contrib/mpi,Mtensorflow/contrib/cloud/kernels/bigquery_table_partition.proto=tensorflow/contrib/cloud/kernels,Mtensorflow/contrib/lite/toco/model_flags.proto=tensorflow/contrib/lite/toco,Mtensorflow/contrib/lite/toco/types.proto=tensorflow/contrib/lite/toco,Mtensorflow/contrib/lite/toco/toco_flags.proto=tensorflow/contrib/lite/toco,Mtensorflow/contrib/tensorboard/graph_explorer/proto/graph_explorer.proto=tensorflow/contrib/tensorboard/graph_explorer/proto,Mtensorflow/contrib/tensorboard/plugins/projector/projector_config.proto=tensorflow/contrib/tensorboard/plugins/projector,Mtensorflow/contrib/tensorboard/plugins/trace/trace_info.proto=tensorflow/contrib/tensorboard/plugins/trace,Mtensorflow/contrib/gdr/gdr.proto=tensorflow/contrib/gdr,Mtensorflow/contrib/tensor_forest/proto/fertile_stats.proto=tensorflow/contrib/tensor_forest/proto,Mtensorflow/contrib/tensor_forest/proto/tensor_forest_params.proto=tensorflow/contrib/tensor_forest/proto,Mtensorflow/contrib/eager/proto/checkpointable_object_graph.proto=tensorflow/contrib/eager/proto,Mtensorflow/contrib/boosted_trees/proto/tree_config.proto=tensorflow/contrib/boosted_trees/proto,Mtensorflow/contrib/boosted_trees/proto/split_info.proto=tensorflow/contrib/boosted_trees/proto,Mtensorflow/contrib/boosted_trees/proto/learner.proto=tensorflow/contrib/boosted_trees/proto,Mtensorflow/contrib/boosted_trees/proto/quantiles.proto=tensorflow/contrib/boosted_trees/proto,Mtensorflow/contrib/tpu/profiler/tpu_profiler.proto=tensorflow/contrib/tpu/profiler,Mtensorflow/contrib/tpu/profiler/trace_events.proto=tensorflow/contrib/tpu/profiler,Mtensorflow/contrib/tpu/profiler/tf_op_stats.proto=tensorflow/contrib/tpu/profiler,Mtensorflow/contrib/tpu/profiler/op_profile.proto=tensorflow/contrib/tpu/profiler,Mtensorflow/contrib/tpu/proto/topology.proto=tensorflow/contrib/tpu/proto,Mtensorflow/contrib/tpu/proto/tpu_embedding_config.proto=tensorflow/contrib/tpu/proto,Mtensorflow/contrib/mpi_collectives/mpi_message.proto=tensorflow/contrib/mpi_collectives,Mtensorflow/contrib/verbs/verbs_service.proto=tensorflow/contrib/verbs,Mtensorflow/contrib/session_bundle/manifest.proto=tensorflow/contrib/session_bundle,Mtensorflow/contrib/decision_trees/proto/generic_tree_model_extensions.proto=tensorflow/contrib/decision_trees/proto,Mtensorflow/contrib/decision_trees/proto/generic_tree_model.proto=tensorflow/contrib/decision_trees/proto,Mtensorflow/contrib/training/python/training/hparam.proto=tensorflow/contrib/training/python/training,Mtensorflow/tools/proto_text/test.proto=tensorflow/tools/proto_text,Mtensorflow/tools/api/lib/api_objects.proto=tensorflow/tools/api/lib,Mtensorflow/core/example/example_parser_configuration.proto=tensorflow/core/example,Mtensorflow/core/example/example.proto=tensorflow/core/example,Mtensorflow/core/example/feature.proto=tensorflow/core/example,Mtensorflow/core/lib/core/error_codes.proto=tensorflow/core/lib/core,Mtensorflow/core/framework/summary.proto=tensorflow/core/framework,Mtensorflow/core/framework/graph.proto=tensorflow/core/framework,Mtensorflow/core/framework/types.proto=tensorflow/core/framework,Mtensorflow/core/framework/api_def.proto=tensorflow/core/framework,Mtensorflow/core/framework/remote_fused_graph_execute_info.proto=tensorflow/core/framework,Mtensorflow/core/framework/node_def.proto=tensorflow/core/framework,Mtensorflow/core/framework/allocation_description.proto=tensorflow/core/framework,Mtensorflow/core/framework/resource_handle.proto=tensorflow/core/framework,Mtensorflow/core/framework/attr_value.proto=tensorflow/core/framework,Mtensorflow/core/framework/tensor_shape.proto=tensorflow/core/framework,Mtensorflow/core/framework/versions.proto=tensorflow/core/framework,Mtensorflow/core/framework/tensor.proto=tensorflow/core/framework,Mtensorflow/core/framework/variable.proto=tensorflow/core/framework,Mtensorflow/core/framework/cost_graph.proto=tensorflow/core/framework,Mtensorflow/core/framework/iterator.proto=tensorflow/core/framework,Mtensorflow/core/framework/device_attributes.proto=tensorflow/core/framework,Mtensorflow/core/framework/graph_transfer_info.proto=tensorflow/core/framework,Mtensorflow/core/framework/tensor_description.proto=tensorflow/core/framework,Mtensorflow/core/framework/kernel_def.proto=tensorflow/core/framework,Mtensorflow/core/framework/log_memory.proto=tensorflow/core/framework,Mtensorflow/core/framework/tensor_slice.proto=tensorflow/core/framework,Mtensorflow/core/framework/step_stats.proto=tensorflow/core/framework,Mtensorflow/core/framework/reader_base.proto=tensorflow/core/framework,Mtensorflow/core/framework/function.proto=tensorflow/core/framework,Mtensorflow/core/framework/op_def.proto=tensorflow/core/framework,Mtensorflow/core/grappler/costs/op_performance_data.proto=tensorflow/core/grappler/costs,Mtensorflow/core/debug/debugger_event_metadata.proto=tensorflow/core/debug,Mtensorflow/core/debug/debug_service.proto=tensorflow/core/debug,Mtensorflow/core/util/memmapped_file_system.proto=tensorflow/core/util,Mtensorflow/core/util/saved_tensor_slice.proto=tensorflow/core/util,Mtensorflow/core/util/example_proto_fast_parsing_test.proto=tensorflow/core/util,Mtensorflow/core/util/event.proto=tensorflow/core/util,Mtensorflow/core/util/test_log.proto=tensorflow/core/util,Mtensorflow/core/protobuf/meta_graph.proto=tensorflow/core/protobuf,Mtensorflow/core/protobuf/device_properties.proto=tensorflow/core/protobuf,Mtensorflow/core/protobuf/rewriter_config.proto=tensorflow/core/protobuf,Mtensorflow/core/protobuf/control_flow.proto=tensorflow/core/protobuf,Mtensorflow/core/protobuf/cluster.proto=tensorflow/core/protobuf,Mtensorflow/core/protobuf/master.proto=tensorflow/core/protobuf,Mtensorflow/core/protobuf/named_tensor.proto=tensorflow/core/protobuf,Mtensorflow/core/protobuf/queue_runner.proto=tensorflow/core/protobuf,Mtensorflow/core/protobuf/worker.proto=tensorflow/core/protobuf,Mtensorflow/core/protobuf/config.proto=tensorflow/core/protobuf,Mtensorflow/core/protobuf/saver.proto=tensorflow/core/protobuf,Mtensorflow/core/protobuf/master_service.proto=tensorflow/core/protobuf,Mtensorflow/core/protobuf/saved_model.proto=tensorflow/core/protobuf,Mtensorflow/core/protobuf/critical_section.proto=tensorflow/core/protobuf,Mtensorflow/core/protobuf/worker_service.proto=tensorflow/core/protobuf,Mtensorflow/core/protobuf/tensor_bundle.proto=tensorflow/core/protobuf,Mtensorflow/core/protobuf/tensorflow_server.proto=tensorflow/core/protobuf,Mtensorflow/core/protobuf/debug.proto=tensorflow/core/protobuf,Mtensorflow/core/profiler/tfprof_log.proto=tensorflow/core/profiler,Mtensorflow/core/profiler/profile.proto=tensorflow/core/profiler,Mtensorflow/core/profiler/tfprof_output.proto=tensorflow/core/profiler,Mtensorflow/core/profiler/tfprof_options.proto=tensorflow/core/profiler,Mtensorflow_serving/config/model_server_config.proto=tensorflow_serving/config,Mtensorflow_serving/config/platform_config.proto=tensorflow_serving/config,Mtensorflow_serving/config/log_collector_config.proto=tensorflow_serving/config,Mtensorflow_serving/config/logging_config.proto=tensorflow_serving/config,Mtensorflow_serving/sources/storage_path/file_system_storage_path_source.proto=tensorflow_serving/sources/storage_path,Mtensorflow_serving/sources/storage_path/static_storage_path_source.proto=tensorflow_serving/sources/storage_path,Mtensorflow_serving/apis/get_model_status.proto=tensorflow_serving/apis,Mtensorflow_serving/apis/prediction_service.proto=tensorflow_serving/apis,Mtensorflow_serving/apis/classification.proto=tensorflow_serving/apis,Mtensorflow_serving/apis/get_model_metadata.proto=tensorflow_serving/apis,Mtensorflow_serving/apis/internal/serialized_input.proto=tensorflow_serving/apis/internal,Mtensorflow_serving/apis/model_service.proto=tensorflow_serving/apis,Mtensorflow_serving/apis/inference.proto=tensorflow_serving/apis,Mtensorflow_serving/apis/model_management.proto=tensorflow_serving/apis,Mtensorflow_serving/apis/input.proto=tensorflow_serving/apis,Mtensorflow_serving/apis/model.proto=tensorflow_serving/apis,Mtensorflow_serving/apis/predict.proto=tensorflow_serving/apis,Mtensorflow_serving/apis/regression.proto=tensorflow_serving/apis,Mtensorflow_serving/model_servers/test_util/storage_path_error_injecting_source_adapter.proto=tensorflow_serving/model_servers/test_util,Mtensorflow_serving/servables/tensorflow/session_bundle_source_adapter.proto=tensorflow_serving/servables/tensorflow,Mtensorflow_serving/servables/tensorflow/session_bundle_config.proto=tensorflow_serving/servables/tensorflow,Mtensorflow_serving/servables/tensorflow/saved_model_bundle_source_adapter.proto=tensorflow_serving/servables/tensorflow,Mtensorflow_serving/servables/hashmap/hashmap_source_adapter.proto=tensorflow_serving/servables/hashmap,Mtensorflow_serving/util/status.proto=tensorflow_serving/util,Mtensorflow_serving/util/class_registration_test.proto=tensorflow_serving/util,Mtensorflow_serving/resources/resources.proto=tensorflow_serving/resources,Mtensorflow_serving/core/test_util/fake_loader_source_adapter.proto=tensorflow_serving/core/test_util,Mtensorflow_serving/core/logging.proto=tensorflow_serving/core/'
IMP=bitbucket.org\/airenas\/listgo\/internal\/pkg\/tensorflow

gen:
	mkdir -p $@
serving:
	git clone -b r1.7 https://github.com/tensorflow/serving.git
tensorflow:
	git clone -b r1.7 https://github.com/tensorflow/tensorflow.git

.proto.done: gen tensorflow serving
	protoc -I tensorflow -I serving --go_out=gen --go-grpc_out=gen --go_opt=$(GO_OPTS) \
		--go-grpc_opt=$(GO_OPTS) serving/tensorflow_serving/apis/*.proto \
		serving/tensorflow_serving/config/*.proto \
		serving/tensorflow_serving/util/*.proto \
		serving/tensorflow_serving/sources/storage_path/*.proto \
		tensorflow/tensorflow/core/framework/*.proto \
		tensorflow/tensorflow/core/example/*.proto \
		tensorflow/tensorflow/core/lib/core/*.proto \
		tensorflow/tensorflow/core/protobuf/saver.proto \
		tensorflow/tensorflow/core/protobuf/meta_graph.proto
	touch $@

.proto.fixed.done: .proto.done
	find gen -name "*.go" | xargs sed -i "s/\"tensorflow/\"$(IMP)/g"
	touch $@

.done: .proto.fixed.done
	mv gen/tensorflow ../internal/pkg
	mv gen/tensorflow_serving ../internal/pkg
	touch $@

generate: .done

clean/target:
	rm -rf ../internal/pkg/tensorflow
	rm -rf ../internal/pkg/tensorflow_serving

clean:
	rm -f .done .proto.done .proto.fixed.done
	rm -rf gen

clean/source:
	rm -rf tensorflow
	rm -rf serving
